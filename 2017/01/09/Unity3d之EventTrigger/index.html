<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>unity3d之eventtrigger | 木子Jerry Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="unityMonoBehaviour" />
  
  
  
  
  <meta name="description" content="开发了新的UI系统UGUI，附带的事件系统EventSystem不仅可以用于UI，对于场景中的对象也同样适用。网络上有很多使用说明，但是仅仅是怎么用而已……这篇文章是我翻了无数遍官方手册整理出来的，包括自己的理解，还有官方文档的传送门，也许你会有兴趣。
一、 EventSystem对象的说明当我们在场景中创建任一UI对象后，Hierarchy面板中都可以看到系统自动创建了对象EventSyste">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity3d之EventTrigger">
<meta property="og:url" content="http://hellomrli.github.io/2017/01/09/Unity3d之EventTrigger/index.html">
<meta property="og:site_name" content="木子Jerry Blog">
<meta property="og:description" content="开发了新的UI系统UGUI，附带的事件系统EventSystem不仅可以用于UI，对于场景中的对象也同样适用。网络上有很多使用说明，但是仅仅是怎么用而已……这篇文章是我翻了无数遍官方手册整理出来的，包括自己的理解，还有官方文档的传送门，也许你会有兴趣。
一、 EventSystem对象的说明当我们在场景中创建任一UI对象后，Hierarchy面板中都可以看到系统自动创建了对象EventSyste">
<meta property="og:updated_time" content="2017-01-09T15:26:08.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unity3d之EventTrigger">
<meta name="twitter:description" content="开发了新的UI系统UGUI，附带的事件系统EventSystem不仅可以用于UI，对于场景中的对象也同样适用。网络上有很多使用说明，但是仅仅是怎么用而已……这篇文章是我翻了无数遍官方手册整理出来的，包括自己的理解，还有官方文档的传送门，也许你会有兴趣。
一、 EventSystem对象的说明当我们在场景中创建任一UI对象后，Hierarchy面板中都可以看到系统自动创建了对象EventSyste">
  
    <link rel="alternate" href="/atom.xml" title="木子Jerry Blog" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >
  <link rel="stylesheet" href="/css/hiero.css" >
  <link rel="stylesheet" href="/css/glyphs.css" >

</head>

<body>
  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            <a href="/" title="木子Jerry Blog" rel="home">
              木子Jerry Blog</a>
          </h1>
          <div class="site-description">新人开博客，学习、交流</div>

            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">首页</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">归档</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>




  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-Unity3d之EventTrigger" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Unity3d之EventTrigger
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2017/01/09/Unity3d之EventTrigger/" class="article-date">
	  <time datetime="2017-01-09T04:47:15.000Z" itemprop="datePublished">一月 9, 2017</time>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <a id="more"></a>
<p>开发了新的UI系统UGUI，附带的事件系统EventSystem不仅可以用于UI，对于场景中的对象也同样适用。网络上有很多使用说明，但是仅仅是怎么用而已……这篇文章是我翻了无数遍官方手册整理出来的，包括自己的理解，还有官方文档的传送门，也许你会有兴趣。<br><!-- more --></p>
<h1 id="一、-EventSystem对象的说明"><a href="#一、-EventSystem对象的说明" class="headerlink" title="一、 EventSystem对象的说明"></a>一、 EventSystem对象的说明</h1><p>当我们在场景中创建任一UI对象后，Hierarchy面板中都可以看到系统自动创建了对象EventSystem，可以看到该对象下有三个组件：EventSystem、StandaloneInputModule、TouchInputModule，后面两个组件都继承自BaseInputModule。<br>EventSystem组件主要负责处理输入、射线投射以及发送事件。一个场景中只能有一个EventSystem组件，并且需要BaseInputModule类型组件的协助才能工作。EventSystem在一开始的时候会把自己所属对象下的BaseInputModule类型组件加到一个内部列表，并且在每个Update周期通过接口UpdateModules接口调用这些基本输入模块的UpdateModule接口，然后BaseInputModule会在UpdateModule接口中将自己的状态修改成’Updated’，之后BaseInputModule的Process接口才会被调用。<br>BaseInputModule是一个基类模块，负责发送输入事件（点击、拖拽、选中等）到具体对象。EventSystem下的所有输入模块都必须继承自BaseInputModule组件。StandaloneInputModule和TouchInputModule组件是系统提供的标准输入模块和触摸输入模块，我们可以通过继承BaseInputModule实现自己的输入模块。<br>除了以上两个组件，还有一个很重要的组件通过EventSystem对象我们看不到，它是BaseRaycaster组件。BaseRaycaster也是一个基类，前面说的输入模块要检测到鼠标事件必须有射线投射组件才能确定目标对象。系统实现的射线投射类组件有PhysicsRaycaster, Physics2DRaycaster, GraphicRaycaster。这个模块也是可以自己继承BaseRaycaster实现个性化定制。<br>总的来说，EventSystem负责管理，BaseInputModule负责输入，BaseRaycaster负责确定目标对象，目标对象负责接收事件并处理，然后一个完整的事件系统就有了。<br>另外，其实这些说明官方都有提供，这里也就是把英文译成了中文，并整理下，加上自己的理解，有问题的地方请各路神仙多多指教。<br>官方文档在这里：<br>                  <a href="http://docs.unity3d.com/ScriptReference/EventSystems.EventSystem.html" target="_blank" rel="external">http://docs.unity3d.com/ScriptReference/EventSystems.EventSystem.html</a></p>
<h1 id="二、UGUI中的事件系统"><a href="#二、UGUI中的事件系统" class="headerlink" title="二、UGUI中的事件系统"></a>二、UGUI中的事件系统</h1><p>根据第一节中的说明，EventSystem和BaseInputModule是粘在一个对象上的，这两个模块在EventSystem对象上可以直接看到。那么，BaseRaycaster模块呢。。。<br>其实射线检测，肯定是从摄像机发起的，那么BaseRaycaster模块也一定和摄像机关系一定不简单。<br>对于UI模块，在Canvas对象下我们可以看到GraphicRaycaster组件。如果Canvas的渲染模式是SceenSpace-Overlay，那么我们是看不到Camera组件的。所以应该是GraphicRaycaster会对UI不同的渲染模式做特殊处理。<br>因为有GraphicRaycaster组件的原因，Canvas上的所有UI对象，都可以接受输入模块发出的事件，具体事件的处理在第四节说明。</p>
<h1 id="三、场景对象中使用事件系统"><a href="#三、场景对象中使用事件系统" class="headerlink" title="三、场景对象中使用事件系统"></a>三、场景对象中使用事件系统</h1><p>场景中的非UI对象，如果想要接收输入模块的事件，一样的道理，也需要给摄像机挂上一个射线检测组件。PhysicsRaycaster, Physics2Draycaster这两个组件分别是用于3D和2D的场景。当然，还需要场景的对象挂了collider射线才检测的到。<br>         其实官方对射线检测也是做了说明的，如果不详读手册是不会发现的，这里是传送门：<br><a href="http://docs.unity3d.com/Manual/Raycasters.html" target="_blank" rel="external">http://docs.unity3d.com/Manual/Raycasters.html</a><br>         如果场景中只有一个射线检测源：When a Raycaster is present and enabled in the scene it will be used by the EventSystem whenever a query is issued from an InputModule.<br>如果场景中有多个射线检测源：If multiple Raycasters are used then they will all have casting happen against them and the results will be sorted based on distance to the elements.</p>
<h1 id="四、响应事件"><a href="#四、响应事件" class="headerlink" title="四、响应事件"></a>四、响应事件</h1><p>1、输入模块可以检测到的</p>
<p>事件</p>
<p>StandaloneInputModule和TouchInputModule两个组件会检测一些输入操作，以事件的方式（message系统）通知目标对象，那么这两个组件支持的事件主要有以下：</p>
<pre><code>1. IPointerEnterHandler OnPointerEnter Called when a pointer enters the object

2. IPointerExitHandler OnPointerExit Called when a pointer exits the object

3. IPointerDownHandler OnPointerDown Called when a pointer is pressed on the object

4. IPointerUpHandler OnPointerUp Called when a pointer is released (called on the original the pressed object) 

5. IPointerClickHandler OnPointerClick Called when a pointer is pressed and released on the same object

6. IInitializePotentialDragHandler OnInitializePotentialDrag Called when a drag target is found, can be used to initialise values

7. IBeginDragHandler OnBeginDrag Called on the drag object when dragging is about to begin

8. IDragHandler OnDrag Called on the drag object when a drag is happening
9. 
9. IEndDragHandler OnEndDrag Called on the drag object when a drag finishes
10. 
10. IDropHandler OnDrop Called on the object where a drag finishes
11. 
11. IScrollHandler OnScroll Called when a mouse wheel scrolls
12. 
12. IUpdateSelectedHandler OnUpdateSelected Called on the selected object each tick
13. ISelectHandler OnSelect Called when the object becomes the selected object
14. IDeselectHandler OnDeselect Called on the selected object becomes deselected
15. IMoveHandler OnMove Called when a move event occurs (left, right, up, down, ect)
16. ISubmitHandler OnSubmit Called when the submit button is pressed
17. ICancelHandler OnCancel Called when the cancel button is pressed
</code></pre><p>只要目标对象的mono脚本实现了以上接口，那么输入模块会将检测到的事件通过这些接口通知给目标对象。参考：<a href="http://docs.unity3d.com/Manual/SupportedEvents.html" target="_blank" rel="external">http://docs.unity3d.com/Manual/SupportedEvents.html</a><br>如果你自定义了自己的输入模块，那么以上这些事件肯定是不能用的了。</p>
<p>2、接收输入事件的方式<br>         1）、自行继承接口实现监听<br>         在mono脚本中继承输入模块提供的事件接口，如下图。接口的定义方式也可以查下官方手册，<a href="http://docs.unity3d.com/ScriptReference/EventSystems.IBeginDragHandler.html" target="_blank" rel="external">http://docs.unity3d.com/ScriptReference/EventSystems.IBeginDragHandler.html</a> 这边有每一个接口的定义方式，放心大胆地点进去。另外，添加ObjChooseEvent组件的对象，一定要有Collider哦。</p>
<pre><code>2）、 通过EventTrigger组件监听事件
这是一个官方组件。在需要监听事件的对象上，挂上这个组件，然后在Inspector面板展开配置，你会看到这个组件提供了所有输入模块支持的事件类型的监听，如下图。

这种方式的优点是，当你选中一个你要监听的类型，你可以为这个事件类型添加多个监听接口，统一管理，可以清楚的知道到底哪些地方响应了这个事件呢。如果是继承Interface的方式，它将会分散在N个脚本里，一旦出现问题，那查起来一定会很酸爽。
但是这种通过配置的方式，一旦项目多人协作，项目的复杂度起来，这种拖来拽去的配置终究是会有很多问题的，比如某个组件删除，比如响应接口改了个名字~~都会导致配置丢失，而问题又不能及时发现。又或者程序的监听接口因为某些条件而不同。所以也许你会需要第三种方式。
</code></pre><p>3）、动态添加EventTrigger组件或者修改组件</p>
<pre><code>其实http://www.cnblogs.com/zou90512/p/3995932.html 这位同学的博客对这三种方法都做了很详细的说明。
只不过EventTrigger对外提供的接口不是很友好，导致我们需要添加一个监听，仿佛绕了N了山路弯弯，看着就心情不愉快……反而是这位博主后面说的Button的Click事件的实现方式有点意思……如果项目有需要，也许我们也可以这么做……
</code></pre><h1 id="五、EventSystem组件提供的一些有意思的接口"><a href="#五、EventSystem组件提供的一些有意思的接口" class="headerlink" title="五、EventSystem组件提供的一些有意思的接口"></a>五、EventSystem组件提供的一些有意思的接口</h1><p>其实文档都有<a href="http://docs.unity3d.com/ScriptReference/EventSystems.EventSystem.html" target="_blank" rel="external">http://docs.unity3d.com/ScriptReference/EventSystems.EventSystem.html</a> 只是也许你没有注意。<br>点击EventSystem对象，你可以看到运行时候的一些详细数据：</p>
<p>变量：<br>         firstSelectedGameObject：这个值可以在面板设置，如果你需要游戏在启动的时候自动选中某个对象，需要鼠标的那一下点击。<br>         currentSelectedGameObject：当前选中的对象，你可以通过这个值判断当前是否鼠标点击在对象上，因为也许你有拖动摄像机的功能，但是你又不喜欢点击某些对象的时候这个功能又被响应，所以通过这个变量判断是一个很好的办法。</p>
<p>接口：<br>         IsPointerOverGameObject：当前鼠标是否在事件系统可以检测的对象上。<br>         SetSelectedGameObject：这个接口也许你会忽略，但是它很棒。因为你点击场景对象的时候，如果不调用这个接口，你的对象是收不到OnSelect事件的，currentSelectedGameObject的值也不会被设置的，必须在点击事件里调用这个接口设置选中对象！<br>Ex：<br>         public void OnPointerClick(PointerEventData eventData)<br>         {<br>                  print (“OnPointerClick…”);<br>                  currEvent.SetSelectedGameObject(gameObject);<br>         }</p>
<pre><code>    不用在场景里找EventSystem对象，EventSystem组件有一个current静态变量，它就是你要的对象，直接EventSystem.current即可使用。

第一次在蛮牛发文章，word中的图片竟然不能直接copy进来使用……
</code></pre><p>unity3d deactivatemodule;unity3d系统教程;unity 实现事件派发</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/unity/">unity</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MonoBehaviour/">MonoBehaviour</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/unity/">unity</a></li></ul>

      
        
	<div id="comment">
	
	<!-- 多说评论框 start -->
	 <div class="ds-thread" data-thread-key="/2017/01/09/Unity3d之EventTrigger/" data-title="Unity3d之EventTrigger" data-url="http://hellomrli.github.io/2017/01/09/Unity3d之EventTrigger/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"HelloMrLi"};
	  (function() {
	    var ds = document.createElement('script');
	    ds.type = 'text/javascript';ds.async = true;
	    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	    ds.charset = 'UTF-8';
	    (document.getElementsByTagName('head')[0] 
	     || document.getElementsByTagName('body')[0]).appendChild(ds);
	  })();
	  </script>
	<!-- 多说公共JS代码 end -->
	
	</div>
	<link rel="stylesheet" href="/css/comment.css">


      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/01/09/github 传输速度慢解决方法/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          github 传输速度慢解决方法
        
      </div>
    </a>
  
  
    <a href="/2017/01/08/SQL链接异常总结/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">SQL链接异常总结</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、-EventSystem对象的说明"><span class="toc-number">1.</span> <span class="toc-text">一、 EventSystem对象的说明</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、UGUI中的事件系统"><span class="toc-number">2.</span> <span class="toc-text">二、UGUI中的事件系统</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、场景对象中使用事件系统"><span class="toc-number">3.</span> <span class="toc-text">三、场景对象中使用事件系统</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四、响应事件"><span class="toc-number">4.</span> <span class="toc-text">四、响应事件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五、EventSystem组件提供的一些有意思的接口"><span class="toc-number">5.</span> <span class="toc-text">五、EventSystem组件提供的一些有意思的接口</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2017 木子Jerry Blog All Rights Reserved.
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav> -->
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>





  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
  

  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>


</body>
</html>
